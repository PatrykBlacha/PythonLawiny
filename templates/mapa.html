<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mapa Turystyczna</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css" integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js" integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>
</head>
<body>
    <header>Mapa Turystyczna</header>
    <nav>
        <a href="/">Strona główna</a>
        <a href="/mapa">Mapa</a>
        <a href="/pogoda">Pogoda</a>
        <a href="/o-nas">O nas</a>
        <a href="/kontakt">Kontakt</a>
    </nav>
    <input type="text" id="search-box" placeholder="Wyszukaj szczyt...">
    <button onclick="searchPeak()">Szukaj</button>
    <div id="map"></div>
    <script>
        // Inicjalizacja mapy
        var map = L.map('map').setView([49.231556, 19.981972], 13); // Kasprowy Wierch, zoom: 13

        // Dodanie warstwy mapy OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Dodanie markera na Kasprowym Wierchu
        var marker = L.marker([49.231556, 19.981972]).addTo(map);
        marker.bindPopup('<b>Kasprowy Wierch</b><br>Jedno z najpopularniejszych miejsc w Tatrach.').openPopup();


        function searchPeak() {
            var peakName = document.getElementById('search-box').value;
            if (!peakName) {
                alert("Proszę wpisać nazwę szczytu.");
                return;
            }

            // Wysłanie zapytania do backendu
            fetch(`/search_peak?q=${encodeURIComponent(peakName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    // Przesunięcie mapy na znaleziony szczyt
                    map.setView([data.lat, data.lon], 13);

                    // Dodanie markera
                    var marker = L.marker([data.lat, data.lon]).addTo(map);
                    marker.bindPopup(`<b>${data.name}</b>`).openPopup();
                })
                .catch(error => {
                    console.error('Błąd:', error);
                    alert("Wystąpił błąd podczas wyszukiwania.");
                });
        }
    </script>
</body>
</html>